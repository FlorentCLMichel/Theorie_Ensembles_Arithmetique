\RequirePackage{luatex85}
\pdfminorversion=5
\pdfobjcompresslevel=3 
\pdfcompresslevel=9

\documentclass[fontsize=10pt, DIV=15]{scrartcl}
  \pdfprotrudechars1
  \pdfadjustspacing1

\addtokomafont{author}{\color{black!50!white}}
\addtokomafont{date}{\color{black!50!white}}

% section ToCs
\usepackage{tocloft}
\usepackage{etoc}
\renewcommand{\cftsecfont}{\sffamily\bfseries}
\renewcommand{\cftsecpagefont}{\sffamily\bfseries}
\renewcommand{\cftsubsecfont}{\sffamily}
\renewcommand{\cftsubsecpagefont}{\sffamily}
\newcommand{\localtoc}{
    \renewcommand*{\cftsubsecindent}{0em}%
    \renewcommand*{\cftsubsubsecindent}{1em}%
    \renewcommand{\cftsubsecfont}{\sffamily\bfseries}% 
    \renewcommand{\cftsubsecpagefont}{\sffamily\bfseries}% 
    \renewcommand{\cftsubsubsecfont}{\sffamily}% 
    \renewcommand{\cftsubsubsecpagefont}{\sffamily}% 
    \renewcommand{\cftsubsecdotsep}{\cftnodots}%
    \renewcommand{\cftsubsecleader}{\bfseries\cftdotfill{\cftsecdotsep}}%
    \setlength{\cftbeforesubsecskip}{1ex}%
    \etocsettocstyle
        {\hrule\smallskip\vspace*{-2ex}\begin{multicols}{2}}
        {\end{multicols}\vspace*{-2ex}\nobreak\medskip\hrule\bigskip}%
    \etocsettocdepth{3}%
    \localtableofcontents%
}

% toc depth
\setcounter{tocdepth}{2}

\usepackage{fontspec}
  \newfontfeature{Microtype}{protrusion=default;expansion=default;}
\usepackage{polyglossia}
\setmainlanguage{french}
\setotherlanguage{english}
\usepackage{amsmath, amssymb, amsfonts}
\usepackage{mathtools}
\usepackage{enumitem}
%\usepackage{pythontex}
\usepackage[executable=python3]{pyluatex}
\usepackage{soul}
\usepackage[math-style=TeX]{unicode-math}
\setmainfont[Microtype,Ligatures=TeX]{XITS}
\setsansfont{Source Sans 3}
\setmathfont{XITS Math}
\setmonofont{DejaVu Sans Mono}
%\usepackage[final]{microtype}

\usepackage{multicol}
\usepackage{graphicx}  
\usepackage{xcolor}
\usepackage{mathrsfs}
\usepackage{calligra}
\usepackage[many]{tcolorbox}
\usepackage{textcomp}
\usepackage{caption}
\usepackage{xr-hyper}

% for more customizable tables
\usepackage{array}
\usepackage{booktabs}

% Bazin characters
\newfontfamily\bazin{Bazin}
\newcommand*\love{{\bazin^^^^2e43}}
\newcommand*\certainty{{\bazin^^^^2e44}}
\newcommand*\authority{{\bazin^^^^2e45}}
\newcommand*\irony{{\bazin^^^^2e46}}
\newcommand*\acclaim{{\bazin^^^^2e47}}
\newcommand*\doubt{{\bazin^^^^2e48}}

% define some colours
\definecolor{lblue}{rgb}{0.1,0.3,0.9}
\definecolor{darkcyan}{rgb}{0,0.7,0.7}
\definecolor{cYan}{rgb}{0.,1.,1.}
\definecolor{lightcyan}{rgb}{0.5,1.,1.}
\definecolor{lightcyan2}{rgb}{0.7,1.,1.}
\colorlet{lyellow}{yellow!80!white}
\colorlet{lgreen}{green!50!white}
\definecolor{skyblue}{RGB}{0,191,255}
\colorlet{dskyblue}{skyblue!85!black}
\definecolor{turquoise}{RGB}{0,245,255}
\definecolor{darkblue}{RGB}{0,0,100}
\colorlet{linkcolor}{lblue}
\tcbset{colback=white, colframe=black,
        highlight math style= {enhanced, colframe=black, colback=white, boxsep=0pt}}

% hyperref
\usepackage[unicode=true,colorlinks=true,filecolor=linkcolor,linkcolor=linkcolor,citecolor=linkcolor,urlcolor=linkcolor,runcolor=linkcolor,linktoc=all]{hyperref}

% code appearance
\usepackage[outputdir=build]{minted}
\usemintedstyle{nord-darker}
\definecolor{codeBg}{RGB}{0, 15, 30}
\usepackage[space=true]{accsupp}
\newcommand{\copyablespace}{\BeginAccSupp{method=hex,unicode,ActualText=00A0}\hphantom{x}\EndAccSupp{}}
\setminted{
    breaklines=true,
    encoding=utf8,
    fontsize=\small,
    bgcolor=codeBg,
    breaklines,
}

%\usepackage{listings, listings-rust}
%%\definecolor{codecomment}{rgb}{0,0.6,0}
%%\definecolor{codenumber}{rgb}{0.5,0.5,0.5}
%%\definecolor{codestring}{rgb}{0.58,0,0.82}
%%\definecolor{codekey}{RGB}{16,77,147}
%%\definecolor{codebackcolour}{rgb}{0.95,0.95,0.92}
%\definecolor{codecomment}{RGB}{230, 219, 116}
%\definecolor{codenumber}{rgb}{0, 0, 0}
%\definecolor{codestring}{RGB}{230, 219, 116}
%\definecolor{codekey}{RGB}{255, 0, 255}
%\definecolor{codebackcolour}{RGB}{0, 10, 20}
%\definecolor{codenormalcolour}{RGB}{248, 248, 242}
%\lstdefinestyle{mystyle}{
%    backgroundcolor=\color{codebackcolour},   
%    commentstyle=\color{codecomment},
%    keywordstyle=\color{codekey},
%    numberstyle=\tiny\color{codenumber},
%    stringstyle=\color{codestring},
%    rulecolor=\color{black},
%    columns=fullflexible,
%    breakatwhitespace=false,         
%    breaklines=true,
%    captionpos=b,                    
%    keepspaces=true,         
%    %numbers=left,                    
%    %numbersep=5pt,                  
%    showspaces=false,                
%    showstringspaces=false,
%    showtabs=false,                  
%    tabsize=2,
%    literate={\ }{{\copyablespace}}1,
%}
%\usepackage[space=true]{accsupp}
%\newcommand{\copyablespace}{\BeginAccSupp{method=hex,unicode,ActualText=00A0}\hphantom{x}\EndAccSupp{}}
%\lstset{style=mystyle}

% TIKZ
\usepackage{tikz}
\usepackage{pgfplots}
\pgfplotsset{compat=newest}
\usetikzlibrary{calc, tikzmark, arrows.meta, shapes, positioning}
\tikzstyle{na} = [baseline=-.5ex]
\definecolor{zcolor}{rgb}{0.2,0.4,1.}
\newcommand*{\czref}[1]{%
  \begingroup
    \hypersetup{
      filecolor=zcolor
    }%
    \ref{#1}%
  \endgroup
}

% for attaching files
\usepackage{attachfile2}
\attachfilesetup{color = zcolor}

% custom environments
\usepackage{environ}
\NewEnviron{foot}{\footnote{\BODY} } % footnote

% format for footnotes
\deffootnote[\dimexpr1mm+7.5pt\relax]{\dimexpr1mm+0.5pt\relax}{1em}{\thefootnotemark~}

% To add section number to the equation numbers
\numberwithin{equation}{section}

% math commands
\newcommand\mleft{\mathopen{}\mathclose\bgroup\left}
\newcommand\mright{\aftergroup\egroup\right}
\newcommand*{\nn}{\nonumber \\}
\newcommand*{\eq}[1]{(\ref{#1})}
\newcommand*{\eqs}[2]{Eqs.~(\ref{#1}) and~(\ref{#2})}
\newcommand*{\fig}[1]{Fig.~\ref{#1}}
\newcommand{\ket}[1]{\ensuremath{\left\lvert#1\right\rangle}}
\newcommand{\bra}[1]{\ensuremath{\left\langle #1\right\rvert}}
\newcommand*{\eg}{\ensuremath{\hspace*{-0.27 cm} &=& \hspace*{-0.27 cm}}} 
\newcommand*{\be}{\begin{eqnarray}}
\newcommand*{\ee}{\end{eqnarray}}
\newcommand*{\om}{\ensuremath{\omega}}
\newcommand*{\ka}{\ensuremath{\kappa}}
\newcommand*{\pd}{\ensuremath{\partial}}
\newcommand*{\la}{\ensuremath{\lambda}}
\newcommand*{\ep}{\ensuremath{\epsilon}}
\newcommand*{\lp}{\ensuremath{\mleft(}}
\newcommand*{\rp}{\ensuremath{\mright)}}
\newcommand*{\lb}{\ensuremath{\left\lbrace}}
\newcommand*{\rb}{\ensuremath{\right\rbrace}}
\newcommand*{\abs}[1]{\ensuremath{\left\lvert #1 \right\rvert}} 
\newcommand*{\fabs}[1]{\ensuremath{\lvert #1 \rvert}} 
\newcommand*{\mN}{\ensuremath{\mathbb{N}}}
\newcommand*{\mZ}{\ensuremath{\mathbb{Z}}}
\newcommand*{\mQ}{\ensuremath{\mathbb{Q}}}
\newcommand*{\mR}{\ensuremath{\mathbb{R}}}
\newcommand*{\mC}{\ensuremath{\mathbb{C}}}
\newcommand*{\dd}{\ensuremath{\mathrm{d}}}
\newcommand*{\e}{\ensuremath{\mathrm{e}}}
\newcommand*{\ii}{\ensuremath{\mathrm{i}}}
\newcommand*{\ord}[1]{\ensuremath{O \left( #1 \right)}}
\newcommand*{\orde}[1]{\ord{\epsilon^{#1}}}
\newcommand{\df}{\delta \mkern-1.mu f}
\newcommand{\ave}[1]{\left\langle #1 \right\rangle}
\newcommand*{\s}{\nobreak\hspace{.08em plus .04em}}
\newcommand{\scalemath}[2]{\scalebox{#1}{\mbox{\ensuremath{\displaystyle #2}}}}
\newcommand{\innerp}[2]{\ensuremath{\left( #1 \middle\vert #2 \right)}}
\newcommand*{\vstar}{\textcolor{violet}{*}}
\newcommand{\problem}[1]{\noindent\textcolor{violet}{\textbf{*#1}} \bigskip}
\newcommand*{\cstar}{\textcolor{blue}{*}}
\newcommand{\remarque}[1]{\noindent\textcolor{blue}{\textbf{*#1}} \bigskip}
\newcommand{\rem}[1]{\textcolor{blue!90!black}{\textit{#1}} \bigskip}
\newcommand{\tsetminus}{\, \backslash}
\renewcommand{\d}{\delta \!}
\newcommand{\done}{\nopagebreak\hfill\square}

\DeclareMathOperator*{\opropto}{\propto}
\DeclareMathOperator*{\osim}{\sim}
\DeclareMathOperator*{\oeq}{=}
\DeclareMathOperator*{\oap}{\approx}
\DeclareMathOperator*{\olongrightarrow}{\longrightarrow}

% colored box
\newtcolorbox{colbox}[1]{
	breakable,
	enhanced jigsaw,
	sharp corners,
	colback=#1,
	boxrule=0pt,
	frame hidden
}

% color in math mode
\makeatletter
\def\mathcolor#1#{\@mathcolor{#1}}
\def\@mathcolor#1#2#3{%
  \protect\leavevmode
  \begingroup
    \color#1{#2}#3%
  \endgroup
}
\makeatother

\newcommand{\colt}[2]{\tikz[baseline=(current bounding box.base)]\node [fill = #2, inner sep=0.1em, outer sep=0.1em, rounded corners=0.2em, anchor=base] at (0,0) {#1};}
\newcommand{\cole}[2]{\tikz[baseline=(current bounding box.base)]\node [fill = #2, inner sep=0.1em, outer sep=0.1em, rounded corners=0.2em, anchor=base] at (0,0) {$\displaystyle#1$};}
\newcommand{\deft}[1]{\colt{#1}{lgreen}}
\newcommand{\hdeft}[1]{\sethlcolor{lgreen}\hl{#1}}
\newcommand{\defe}[1]{\cole{#1}{lgreen}}
\newcommand{\higt}[1]{\colt{#1}{lyellow}}
\newcommand{\hhigt}[1]{\sethlcolor{lyellow}\hl{#1}}
\newcommand{\hige}[1]{\cole{#1}{lyellow}}
\newcommand{\rest}[1]{\colt{#1}{lightcyan}}
\newcommand{\hrest}[1]{\sethlcolor{lightcyan}\hl{#1}}
\newcommand{\rese}[1]{\cole{#1}{lightcyan}}
\newcommand{\thisiscol}[2]{\textcolor{#1}{\boxed{\textcolor{black}{#2}}}}
\newcommand{\smallres}[1]{\thisiscol{lightgray}{#1}}
\newcommand{\thisisred}[1]{\thisiscol{red}{#1}}
\newcommand{\thisisgreen}[1]{\thisiscol{green}{#1}}
\newcommand{\thisisblue}[1]{\thisiscol{blue}{#1}}
\newcommand{\blau}[1]{\thisiscol{darkblue}{#1}}

%\newcommand{\Fstar}{\includegraphics[width=1ex]{../../Pensées/M/geo/geo.pdf}}
\newcommand{\Fstar}{\includegraphics[width=1ex]{../../Pensées/M/virgule.pdf}}

\pgfdeclarelayer{bg}    % declare background layer
\pgfsetlayers{bg,main}  % set the order of the layers (main is the standard layer)

\def\changemargin#1#2{\list{}{\rightmargin#2\leftmargin#1}\item[]}
\let\endchangemargin=\endlist 

\newcommand{\rcy}[1]{
	\noindent
	\begin{tikzpicture}
	\node [text width=\textwidth] (0,0) (mybox1)
	{
	\textcolor{cYan}{\sffamily#1}
	};
	\begin{pgfonlayer}{bg}
		\fill [black, thick] ($(mybox1.south west)$) -- ($(mybox1.north west)$) -- ($(mybox1.north east)$) -- ($(mybox1.south east)$) -- ($(mybox1.south west)$);
	\end{pgfonlayer}
	\end{tikzpicture}
}
\newcommand{\rbw}[1]{
	\noindent
	\begin{tikzpicture}
	\node [text width=\textwidth, align=justify] (0,0) (mybox1)
	{
	\textcolor{white}{\sffamily#1}
	};
	\begin{pgfonlayer}{bg}
		\fill [black, thick] ($(mybox1.south west)$) -- ($(mybox1.north west)$) -- ($(mybox1.north east)$) -- ($(mybox1.south east)$) -- ($(mybox1.south west)$);
	\end{pgfonlayer}
	\end{tikzpicture}
}
\newcommand{\rbb}[1]{
	\noindent
	\begin{tikzpicture}
	\node [text width=\textwidth, align=justify] (0,0) (mybox1)
	{
	\textcolor{blue!50!black}{\textit{#1}}
	};
	\begin{pgfonlayer}{bg}
		\fill [black!5, thick] ($(mybox1.south west)$) -- ($(mybox1.north west)$) -- ($(mybox1.north east)$) -- ($(mybox1.south east)$) -- ($(mybox1.south west)$);
	\end{pgfonlayer}
	\end{tikzpicture}
}
\newcommand{\bkgcol}[2]{
	\noindent
	\begin{tikzpicture}
	\node [text width=\textwidth] (0,0) (mybox1)
	{
	#2
	};
	\begin{pgfonlayer}{bg}
		\fill [#1, thick] ($(mybox1.south west)$) -- ($(mybox1.north west)$) -- ($(mybox1.north east)$) -- ($(mybox1.south east)$) -- ($(mybox1.south west)$);
	\end{pgfonlayer}
	\end{tikzpicture}
}
\newenvironment{myarray}%
 {\def\arraystretch{1.4}\everymath{\displaystyle\everymath{}}\array}%
 {\endarray}

% To access teX variables through Python 
\makeatletter
\newcommand{\pythontexassign}[2]{%
  \expandafter\pythontexassign@i\expandafter{#2}{#1}}
\newcommand{\pythontexassign@i}[2]{%
  \pyc{#2=#1}}
\makeatother
